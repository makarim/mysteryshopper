<?php include_once("header.html")?>

<div id="wrap">  <br />
	<?php include_once("home_left.html")?>
    <div class="admincontent">
		<?php include_once("home_assignmenttop.html")?>
		
<script src="<?php echo $www_site_url?>/public/js/common.js" type="text/javascript"></script>
<script src="<?php echo $www_site_url?>/public/js/vote.js" type="text/javascript"></script>
<script>

function checkform(form){
	var g=function(n){
		return form.getElementsByTagName(n);
	};
	var va=function(e){
		if(e.name) return encodeURIComponent(e.value);
	};
	var check=function(r){
		for(var i=0;i<r.length;i++){
			if(r[i].checked) return true;
		}
		return false;
	}
	var result = true;
	
	var input = g('input');
	for(var i=0;i<input.length;i++){
		var v = va(input[i]);
		if(input[i].type=='text' || input[i].type=='hidden'){
			if( v==''){
				input[i].parentNode.style.border='1px solid red';
				result=false;
			}else{
				input[i].parentNode.style.border='';
			}
		} 
		if(input[i].type=='radio'){
			if(check(form.elements[input[i].name])){
				input[i].parentNode.style.border='';
			}else{
				input[i].parentNode.style.border='1px solid red';
			}
		}
	}
	
	var textarea = g('textarea');
	for(var i=0;i<textarea.length;i++){
		var v=va(textarea[i]);
		if(v==''){
			textarea[i].style.border='1px solid red';
			result=false;
		}else{
			textarea[i].style.border='';
		}
	}
	if(!result) alert("对不起，请完成标红的题目！");
	if(result && confirm("请注意：未执行任务而填写调查问卷，将会被工作人员审查出来！确认要提交吗？")){
		return result;
	}else{
		return false;
	}
	

}
	
	
</script>

	<?php if($is_view && $assignmentinfo['a_quiz_pass']>0){
		if($is_submitted==0 || $is_submitted==2){
			
			if($is_submitted==2){
				echo ' <p>&nbsp;</p>您的问卷审批结果为: 不合格!';
			}
		if(isset($report_questions) && is_array($report_questions)){?>
			<br /><br />
				 <br />
		    <p>评分说明：</p>
			<table width="100%" border="0" cellpadding="0" cellspacing="1" class="missionReport" class="clear">
          <tr>
            <td class="title">不适用</td>
            <td class="title">差</td>
            <td class="title">不好</td>
            <td class="title">需要改进</td>
            <td class="title">一般</td>
            <td class="title">好</td>
            <td class="title">很好</td>
            <td class="title">完美</td>
          </tr> 
          <tr>
            <td align="center">n/a</td>
            <td align="center">0</td>
            <td align="center">1-2</td>
            <td align="center">3-4</td>
            <td align="center">5</td>
            <td align="center">6-7</td>
            <td align="center">8-9</td>
            <td align="center">10</td>
          </tr>
       
          </table>
         
         <form action="<?php echo $www_site_url?>/index.php" method="post" onsubmit="return checkform(this);">
				<input type="hidden" name="action" value="home">
				<input type="hidden" name="op" value="savereport">
				<input type="hidden" name="a_id" value="<?php echo $a_id;?>">
       <?php
		foreach ($report_questions as $k=>$v){?>
		<table width="100%" border="0" cellpadding="0" cellspacing="1" class="missionReport" style="margin-top:10px;">
          <tr>
            <td colspan="3" class="title"><?php echo lang($k);?></td>
          </tr>
          <?php
			foreach ($v as $kk=>$vv){
				if($vv['rq_type']==2 || $vv['rq_type']==4 || $vv['rq_type']==1){
				?>
          <tr>
			 <td width="5%"><?php echo $GLOBALS['gGroupsCap'][$k]. "".($kk+1)?></td>
            <td width="60%"><?php echo $vv['rq_question']?> <span id="span_ch_<?php echo $vv['rq_id'];?>" style="float:right;"></span></td>
            <td  width="35%" align="center">
            <?php if($vv['rq_type']==2){?><label style="float:left;"><input type="checkbox" id="votebox_<?php echo $vv['rq_id'];?>" name="votebox_<?php echo $vv['rq_id'];?>" onclick="out_fs('yes_<?php echo $vv['rq_id'];?>_10');" <?php if($vv['answer']=='A') echo "checked"; ?>>N/A</label><div id="voteimg_<?php echo $vv['rq_id'];?>"></div>	
								<input type="hidden" id="rq_ans_<?php echo $vv['rq_id'];?>" name="rq_ans_<?php echo $vv['rq_type']."_".$vv['rq_id'];?>" value="<?php echo $vv['answer'];?>">
								<script>create_vote_img(<?php echo $vv['rq_id'];?>,'<?php echo $vv['answer'];?>');</script>	
								
								<?php }else if($vv['rq_type']==1){ ?>		
								<label><input type="radio" name="rq_ans_<?php echo $vv['rq_type']."_".$vv['rq_id'];?>" value="A" <?php if($vv['answer']=='A')echo 'checked'; ?>>N/A ;</label>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="rq_ans_<?php echo $vv['rq_type']."_".$vv['rq_id'];?>" value="Y" <?php if($vv['answer']=='Y')echo 'checked'; ?>>Yes ;</label>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="rq_ans_<?php echo $vv['rq_type']."_".$vv['rq_id'];?>" value="N"  <?php if($vv['answer']=='N')echo 'checked'; ?>>No;</label>
								
									<?php }else if($vv['rq_type']==4){ ?>	
								<input type="text" size="6" name="rq_ans_<?php echo $vv['rq_type']."_".$vv['rq_id'];?>" value="<?php echo $vv['answer']; ?>">	分钟
							<?php }?>
            </td>
          </tr>
       		 <?php 
				}else if($vv['rq_type']==3){ 
			?>
			  <?php  
					if($vv['rq_group']==5){
					?>	
			<tr>
			 <td width="5%" valign="top"><?php echo $GLOBALS['gGroupsCap'][$k]. "".($kk+1)?></td>
			 <td width="60%"><?php echo $vv['rq_question']?></td>
            <td  width="35%" align="center"><input class="textfield" type="text" name="rq_ans_<?php echo $vv['rq_type']."_".$vv['rq_id'];?>" value="<?php echo $vv['answer']; ?>"></td>
                        
          </tr>
          <? }else{?>
			<tr>
			 <td width="5%" valign="top"><?php echo $GLOBALS['gGroupsCap'][$k]. "".($kk+1)?></td>
             <td width="95%" colspan="2" style="padding:0">
            
		            <table width="100%" border="0" cellpadding="0" cellspacing="0">
			            <tr> 
			            	<td width="50%" style="background-color:#ccc;"> <?php echo $vv['rq_question']?></td>
			            
			          	</tr>
			           <tr>
				           <td style="height:50px">
													<textarea  style="width:100%;font-size:12px;height:60px;" name="rq_ans_<?php echo $vv['rq_type']."_".$vv['rq_id'];?>"><?php echo $vv['answer']; ?></textarea>
				           </td>
			            </tr>
		             </table>
            </td>
          </tr>	
	   <?php } 
			
				}
				
			}
			?>
			
        </table>
 		<?php }?>
 		<table width="100%" height="50">
	 		<tr>
				<td align="center"><input type="submit" value="<?php echo lang('submit')?>" class="btn" /></td>
			</tr>
		</table>
		</form>
				
			

				
  <?php 	}
  
		}elseif($is_submitted==3){
			echo ' <p>&nbsp;</p>您已经提交过问卷了! 请等待审批结果!';
		}elseif($is_submitted==1){
			echo ' <p>&nbsp;</p>恭喜! 您的问卷已经被审批通过!';
		}
	}else{?>
   <p>&nbsp;</p>
   <p>&nbsp;</p>
   <p>&nbsp;</p>
   <p>请预先报名，通过小测试，执行完任务后才能填写报告！</p>
  <?php }?>
  
  </div>
</div>
<?php include_once("footer.html")?>
