<?php include_once("header.html")?>
<script src="<?php echo $www_site_url?>/public/js/ajax.js" type="text/javascript"></script>
<div id="wrap">  <br />

<?php include_once("home_left.html")?>

      <script>
function printpage(oper){
	 bdhtml=window.document.body.innerHTML;//获取当前页的html代码
	sprnstr="<!--startprint"+oper+"-->";//设置打印开始区域
	eprnstr="<!--endprint"+oper+"-->";//设置打印结束区域
	prnhtml=bdhtml.substring(bdhtml.indexOf(sprnstr)+18); //从开始代码向后取html
	var css = '';
	prnhtml=prnhtml.substring(0,prnhtml.indexOf(eprnstr));//从结束代码向前取html
	window.document.body.innerHTML=prnhtml;
	//window.print();
	var url = "<?php echo $www_site_url?>/plugins/generatepdf.php";
	//var params = mini.form.serialize($(formName));

	mini.ajax.post(url, function(r){
		alert(r);
		var r = eval('(' + r + ')');   

		if(r.s==200){
			alert(r.m);
			window.location.href = r.d;
		}
		if(r.s==400){
			alert(r.m);
			$('msg').innerHTML = r.m;			
		}
	}, "c="+css+prnhtml);

	window.document.body.innerHTML=bdhtml;
}

</script>
<div class="admincontent">

		<div style="float:right;margin-right:10px;">
      <a href="javascript:printpage(1);"><img src="<?php echo $www_site_url?>/public/images/print_icon.jpg" border="0" title="Print"></a>
      </div>
      <!--startprint1-->
		<?php if(isset($report_questions) && is_array($report_questions)){?>
			
		    <p>评分说明：</p>
			<table width="100%" border="1" cellpadding="0" cellspacing="1" class="missionReport">
          <tr>
            <td  height="30" class="title" bgcolor="#9F0000" align="left"><font color="#FFF">不适用</font></td>
            <td  height="30" class="title" bgcolor="#9F0000" align="left"><font color="#FFF">差</font></td>
            <td  height="30" class="title" bgcolor="#9F0000" align="left"><font color="#FFF">不好</font></td>
            <td  height="30" class="title" bgcolor="#9F0000" align="left"><font color="#FFF">需要改进</font></td>
            <td  height="30" class="title" bgcolor="#9F0000" align="left"><font color="#FFF">一般</font></td>
            <td  height="30" class="title" bgcolor="#9F0000" align="left"><font color="#FFF">好</font></td>
            <td  height="30" class="title" bgcolor="#9F0000" align="left"><font color="#FFF">很好</font></td>
            <td  height="30" class="title" bgcolor="#9F0000" align="left"><font color="#FFF">完美</font></td>
          </tr> 
          <tr>
            <td align="center">n/a</td>
            <td align="center">0</td>
            <td align="center">1-2</td>
            <td align="center">3-4</td>
            <td align="center">5</td>
            <td align="center">6-7</td>
            <td align="center">8-9</td>
            <td align="center">10</td>
          </tr>
       
          </table>
         
	<?php
		foreach ($report_questions as $k=>$v){?>
		<table width="100%" border="1" cellpadding="0" cellspacing="1" class="missionReport" style="margin-top:20px;">
          <tr>
            <td colspan="3" class="title" bgcolor="#9F0000" align="center" height="25"><font color="#FFF"><?php echo lang($k);?></font></td>
          </tr>
          <?php
			foreach ($v as $kk=>$vv){
				if($vv['rq_type']==2 || $vv['rq_type']==4 || $vv['rq_type']==1){
				?>
          <tr>
			 <td width="30"><?php echo $GLOBALS['gGroupsCap'][$k]. "".($kk+1)?></td>
            <td align="left"><?php echo multiwordbreak($vv['rq_question']);?></td>
            <td width="100" align="left">
            <?php 
            	if($vv['rq_type']==2){
            		if($vv['answer']=='A') echo 'N/A';
            		else 
            		echo $vv['answer']; 
            	}else if($vv['rq_type']==1){ 
					if($vv['answer']=='Y')echo 'Yes'; 
					if($vv['answer']=='N')echo 'No';  
					if($vv['answer']=='A')echo 'N/A';  
            	}else if($vv['rq_type']==4){ 
            		echo $vv['answer']."分钟"; 
				 }?>
            </td>
          </tr>
       		 <?php 
				}else if($vv['rq_type']==3){ 
			
					if($vv['rq_group']==5){
					?>	
			<tr>
			 <td width="30"><?php echo $GLOBALS['gGroupsCap'][$k]. "".($kk+1)?></td>
			  <td align="left" ><?php echo multiwordbreak($vv['rq_question']);?></td>
              <td width="100" align="left"><?php echo $vv['answer']; ?></td>
          	</tr>
          <? }else{?>
			<tr>
			 <td width="30" rowspan="2" valign="top"><?php echo $GLOBALS['gGroupsCap'][$k]. "".($kk+1)?></td>
             <td colspan="2"  bgcolor="#aaa" height="30" >
            		<?php echo multiwordbreak($vv['rq_question']);?>
            </td>
          </tr>	
          <tr>
             <td colspan="2" height="50">
            		<?php echo multiwordbreak($vv['answer']); ?>
            </td>
          </tr>	
	   <?php } 
			
				}
				
			}
			?>
			
        </table>
 		<?php }
		}?>
		
 		<!--endprint1-->
				

</div>

</div>


<?php
function multiwordbreak($str){
	$len = mb_strlen($str, 'UTF-8');
	$ch = '';
	$maxlen = 33;
	
	for ($i=0; $i < $len; $i++){
		if($i%$maxlen==0){
			  $ch .= mb_substr($str, $i, $maxlen, 'UTF-8')."<br />";
		}
    }
	
    return $ch;
}

include_once("footer.html")?>
